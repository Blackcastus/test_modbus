ARM GAS  /tmp/ccGXey88.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"modbus_data.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.Modbus_Master_DMA_Init,"ax",%progbits
  16              		.align	1
  17              		.global	Modbus_Master_DMA_Init
  18              		.arch armv7-m
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu softvfp
  24              	Modbus_Master_DMA_Init:
  25              	.LVL0:
  26              	.LFB197:
  27              		.file 1 "User/Modbus/modbus_data.c"
   1:User/Modbus/modbus_data.c **** #include "modbus_data.h"
   2:User/Modbus/modbus_data.c **** #include "modbus_crc.h"
   3:User/Modbus/modbus_data.c **** #include "usart.h"
   4:User/Modbus/modbus_data.c **** 
   5:User/Modbus/modbus_data.c **** // Modbus Register
   6:User/Modbus/modbus_data.c **** Modbus_State_t slave;
   7:User/Modbus/modbus_data.c **** uint16_t modbus_holding_buf[NoB_HOLDING_REGISTER] = {0},
   8:User/Modbus/modbus_data.c **** 		modbus_input_buf[NoB_INPUT_REGISTER] = {0};
   9:User/Modbus/modbus_data.c **** uint16_t modbus_master_hold_buf[MB_MASTER_SLAVE_NUM][NoB_HOLDING_REGISTER];
  10:User/Modbus/modbus_data.c **** uint32_t modbus_tick_timeout;
  11:User/Modbus/modbus_data.c **** 
  12:User/Modbus/modbus_data.c **** void Modbus_Master_DMA_Init(void *dHUART, uint32_t ulBaudRate)
  13:User/Modbus/modbus_data.c **** {
  28              		.loc 1 13 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 13 1 is_stmt 0 view .LVU1
  33 0000 08B5     		push	{r3, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 8
  36              		.cfi_offset 3, -8
  37              		.cfi_offset 14, -4
  14:User/Modbus/modbus_data.c ****     // init uart connect with slaver
  15:User/Modbus/modbus_data.c ****     MX_USART2_UART_Init(ulBaudRate);
  38              		.loc 1 15 5 is_stmt 1 view .LVU2
  39 0002 0846     		mov	r0, r1
  40              	.LVL1:
  41              		.loc 1 15 5 is_stmt 0 view .LVU3
  42 0004 FFF7FEFF 		bl	MX_USART2_UART_Init
  43              	.LVL2:
ARM GAS  /tmp/ccGXey88.s 			page 2


  16:User/Modbus/modbus_data.c **** }
  44              		.loc 1 16 1 view .LVU4
  45 0008 08BD     		pop	{r3, pc}
  46              		.cfi_endproc
  47              	.LFE197:
  49              		.section	.rodata.Modbus_Master_DMA_Process.str1.4,"aMS",%progbits,1
  50              		.align	2
  51              	.LC0:
  52 0000 43686563 		.ascii	"Check CRC Error @@\000"
  52      6B204352 
  52      43204572 
  52      726F7220 
  52      404000
  53              		.section	.text.Modbus_Master_DMA_Process,"ax",%progbits
  54              		.align	1
  55              		.global	Modbus_Master_DMA_Process
  56              		.syntax unified
  57              		.thumb
  58              		.thumb_func
  59              		.fpu softvfp
  61              	Modbus_Master_DMA_Process:
  62              	.LFB198:
  17:User/Modbus/modbus_data.c **** 
  18:User/Modbus/modbus_data.c **** 
  19:User/Modbus/modbus_data.c **** MB_Error_Code_t Modbus_Master_DMA_Process(void)
  20:User/Modbus/modbus_data.c **** {
  63              		.loc 1 20 1 is_stmt 1 view -0
  64              		.cfi_startproc
  65              		@ args = 0, pretend = 0, frame = 0
  66              		@ frame_needed = 0, uses_anonymous_args = 0
  21:User/Modbus/modbus_data.c ****     // id | fc | reg_addH | reg_addL | reg_dataH | reg_dataL | crcH | crcL
  22:User/Modbus/modbus_data.c **** 
  23:User/Modbus/modbus_data.c ****     /* code */
  24:User/Modbus/modbus_data.c ****     if (dma_uart2_rx.state) // da nhan xong frame modbus => xu ly
  67              		.loc 1 24 5 view .LVU6
  68              		.loc 1 24 21 is_stmt 0 view .LVU7
  69 0000 214B     		ldr	r3, .L17
  70 0002 93F80134 		ldrb	r3, [r3, #1025]	@ zero_extendqisi2
  71              		.loc 1 24 8 view .LVU8
  72 0006 03B9     		cbnz	r3, .L15
  25:User/Modbus/modbus_data.c ****     {
  26:User/Modbus/modbus_data.c ****         if (Modbus_Check_Crc16(dma_uart2_rx.data, dma_uart2_rx.length)) // check crc is OK
  27:User/Modbus/modbus_data.c ****         {
  28:User/Modbus/modbus_data.c ****             switch (dma_uart2_rx.data[1])       // Check Function code
  29:User/Modbus/modbus_data.c ****             {
  30:User/Modbus/modbus_data.c ****                 case R_HOLD_REGS:   // fc is read
  31:User/Modbus/modbus_data.c ****                 {
  32:User/Modbus/modbus_data.c ****                     uint8_t id_slaver;
  33:User/Modbus/modbus_data.c ****                     uint16_t total_reg;
  34:User/Modbus/modbus_data.c ****                     id_slaver = dma_uart2_rx.data[0];
  35:User/Modbus/modbus_data.c **** 					total_reg = dma_uart2_rx.data[2]/2;
  36:User/Modbus/modbus_data.c **** 
  37:User/Modbus/modbus_data.c ****                     if(id_slaver > MB_MASTER_SLAVE_NUM || total_reg > NoB_HOLDING_REGISTER)
  38:User/Modbus/modbus_data.c ****                         return;
  39:User/Modbus/modbus_data.c ****                     for(int i = slave.reg_hold_start, j = 3; i < total_reg; i++ ,j += 2)
  40:User/Modbus/modbus_data.c ****                     {
  41:User/Modbus/modbus_data.c ****                         modbus_master_hold_buf[id_slaver-1][i] = dma_uart2_rx.data[j] << 8 | dma_ua
ARM GAS  /tmp/ccGXey88.s 			page 3


  42:User/Modbus/modbus_data.c ****                     }
  43:User/Modbus/modbus_data.c ****                     break;
  44:User/Modbus/modbus_data.c ****                 }
  45:User/Modbus/modbus_data.c ****                 case W_SINGLE_REG: // single write
  46:User/Modbus/modbus_data.c **** 
  47:User/Modbus/modbus_data.c ****                     break;
  48:User/Modbus/modbus_data.c **** 
  49:User/Modbus/modbus_data.c ****                 default:
  50:User/Modbus/modbus_data.c ****                     break;
  51:User/Modbus/modbus_data.c ****             }
  52:User/Modbus/modbus_data.c ****         }
  53:User/Modbus/modbus_data.c ****         else
  54:User/Modbus/modbus_data.c ****         {
  55:User/Modbus/modbus_data.c ****             printf("Check CRC Error @@\n");
  56:User/Modbus/modbus_data.c ****             return MC_CRCERR;
  57:User/Modbus/modbus_data.c ****         }
  58:User/Modbus/modbus_data.c ****         /* Reset */
  59:User/Modbus/modbus_data.c ****         slave.index = WATTING_OK;
  60:User/Modbus/modbus_data.c ****         slave.wait = NOWAIT;
  61:User/Modbus/modbus_data.c ****         dma_uart2_rx.state = 0;
  62:User/Modbus/modbus_data.c ****         dma_uart2_rx.length = 0;
  63:User/Modbus/modbus_data.c ****     }
  64:User/Modbus/modbus_data.c ****     
  65:User/Modbus/modbus_data.c **** }
  73              		.loc 1 65 1 view .LVU9
  74 0008 7047     		bx	lr
  75              	.L15:
  20:User/Modbus/modbus_data.c ****     // id | fc | reg_addH | reg_addL | reg_dataH | reg_dataL | crcH | crcL
  76              		.loc 1 20 1 view .LVU10
  77 000a 10B5     		push	{r4, lr}
  78              	.LCFI1:
  79              		.cfi_def_cfa_offset 8
  80              		.cfi_offset 4, -8
  81              		.cfi_offset 14, -4
  26:User/Modbus/modbus_data.c ****         {
  82              		.loc 1 26 9 is_stmt 1 view .LVU11
  26:User/Modbus/modbus_data.c ****         {
  83              		.loc 1 26 13 is_stmt 0 view .LVU12
  84 000c 1E48     		ldr	r0, .L17
  85 000e B0F80214 		ldrh	r1, [r0, #1026]
  86 0012 0130     		adds	r0, r0, #1
  87 0014 FFF7FEFF 		bl	Modbus_Check_Crc16
  88              	.LVL3:
  26:User/Modbus/modbus_data.c ****         {
  89              		.loc 1 26 12 view .LVU13
  90 0018 80B3     		cbz	r0, .L5
  28:User/Modbus/modbus_data.c ****             {
  91              		.loc 1 28 13 is_stmt 1 view .LVU14
  28:User/Modbus/modbus_data.c ****             {
  92              		.loc 1 28 38 is_stmt 0 view .LVU15
  93 001a 1B4B     		ldr	r3, .L17
  94 001c 9B78     		ldrb	r3, [r3, #2]	@ zero_extendqisi2
  28:User/Modbus/modbus_data.c ****             {
  95              		.loc 1 28 13 view .LVU16
  96 001e 032B     		cmp	r3, #3
  97 0020 0AD0     		beq	.L16
  98              	.L6:
ARM GAS  /tmp/ccGXey88.s 			page 4


  59:User/Modbus/modbus_data.c ****         slave.wait = NOWAIT;
  99              		.loc 1 59 9 is_stmt 1 view .LVU17
  59:User/Modbus/modbus_data.c ****         slave.wait = NOWAIT;
 100              		.loc 1 59 21 is_stmt 0 view .LVU18
 101 0022 1A4A     		ldr	r2, .L17+4
 102 0024 0223     		movs	r3, #2
 103 0026 D372     		strb	r3, [r2, #11]
  60:User/Modbus/modbus_data.c ****         dma_uart2_rx.state = 0;
 104              		.loc 1 60 9 is_stmt 1 view .LVU19
  60:User/Modbus/modbus_data.c ****         dma_uart2_rx.state = 0;
 105              		.loc 1 60 20 is_stmt 0 view .LVU20
 106 0028 0023     		movs	r3, #0
 107 002a 9372     		strb	r3, [r2, #10]
  61:User/Modbus/modbus_data.c ****         dma_uart2_rx.length = 0;
 108              		.loc 1 61 9 is_stmt 1 view .LVU21
  61:User/Modbus/modbus_data.c ****         dma_uart2_rx.length = 0;
 109              		.loc 1 61 28 is_stmt 0 view .LVU22
 110 002c 164A     		ldr	r2, .L17
 111 002e 82F80134 		strb	r3, [r2, #1025]
  62:User/Modbus/modbus_data.c ****     }
 112              		.loc 1 62 9 is_stmt 1 view .LVU23
  62:User/Modbus/modbus_data.c ****     }
 113              		.loc 1 62 29 is_stmt 0 view .LVU24
 114 0032 A2F80234 		strh	r3, [r2, #1026]	@ movhi
 115              	.L3:
 116              		.loc 1 65 1 view .LVU25
 117 0036 10BD     		pop	{r4, pc}
 118              	.L16:
 119              	.LBB2:
  32:User/Modbus/modbus_data.c ****                     uint16_t total_reg;
 120              		.loc 1 32 21 is_stmt 1 view .LVU26
  33:User/Modbus/modbus_data.c ****                     id_slaver = dma_uart2_rx.data[0];
 121              		.loc 1 33 21 view .LVU27
  34:User/Modbus/modbus_data.c **** 					total_reg = dma_uart2_rx.data[2]/2;
 122              		.loc 1 34 21 view .LVU28
  34:User/Modbus/modbus_data.c **** 					total_reg = dma_uart2_rx.data[2]/2;
 123              		.loc 1 34 31 is_stmt 0 view .LVU29
 124 0038 134B     		ldr	r3, .L17
 125 003a 93F801E0 		ldrb	lr, [r3, #1]	@ zero_extendqisi2
 126              	.LVL4:
  35:User/Modbus/modbus_data.c **** 
 127              		.loc 1 35 6 is_stmt 1 view .LVU30
  35:User/Modbus/modbus_data.c **** 
 128              		.loc 1 35 35 is_stmt 0 view .LVU31
 129 003e 93F803C0 		ldrb	ip, [r3, #3]	@ zero_extendqisi2
  35:User/Modbus/modbus_data.c **** 
 130              		.loc 1 35 16 view .LVU32
 131 0042 4FEA5C0C 		lsr	ip, ip, #1
 132              	.LVL5:
  37:User/Modbus/modbus_data.c ****                         return;
 133              		.loc 1 37 21 is_stmt 1 view .LVU33
  37:User/Modbus/modbus_data.c ****                         return;
 134              		.loc 1 37 23 is_stmt 0 view .LVU34
 135 0046 BEF1100F 		cmp	lr, #16
 136 004a F4D8     		bhi	.L3
  39:User/Modbus/modbus_data.c ****                     {
 137              		.loc 1 39 21 is_stmt 1 view .LVU35
ARM GAS  /tmp/ccGXey88.s 			page 5


 138              	.LBB3:
  39:User/Modbus/modbus_data.c ****                     {
 139              		.loc 1 39 25 view .LVU36
  39:User/Modbus/modbus_data.c ****                     {
 140              		.loc 1 39 38 is_stmt 0 view .LVU37
 141 004c 0F4B     		ldr	r3, .L17+4
 142 004e 5A88     		ldrh	r2, [r3, #2]
 143              	.LVL6:
  39:User/Modbus/modbus_data.c ****                     {
 144              		.loc 1 39 55 view .LVU38
 145 0050 0321     		movs	r1, #3
 146              	.LVL7:
 147              	.L8:
  39:User/Modbus/modbus_data.c ****                     {
 148              		.loc 1 39 62 is_stmt 1 discriminator 1 view .LVU39
  39:User/Modbus/modbus_data.c ****                     {
 149              		.loc 1 39 21 is_stmt 0 discriminator 1 view .LVU40
 150 0052 9445     		cmp	ip, r2
 151 0054 E5DD     		ble	.L6
  41:User/Modbus/modbus_data.c ****                     }
 152              		.loc 1 41 25 is_stmt 1 discriminator 3 view .LVU41
  41:User/Modbus/modbus_data.c ****                     }
 153              		.loc 1 41 83 is_stmt 0 discriminator 3 view .LVU42
 154 0056 0C4B     		ldr	r3, .L17
 155 0058 5818     		adds	r0, r3, r1
 156 005a 4478     		ldrb	r4, [r0, #1]	@ zero_extendqisi2
  41:User/Modbus/modbus_data.c ****                     }
 157              		.loc 1 41 114 discriminator 3 view .LVU43
 158 005c 481C     		adds	r0, r1, #1
  41:User/Modbus/modbus_data.c ****                     }
 159              		.loc 1 41 111 discriminator 3 view .LVU44
 160 005e 0344     		add	r3, r3, r0
 161 0060 5878     		ldrb	r0, [r3, #1]	@ zero_extendqisi2
  41:User/Modbus/modbus_data.c ****                     }
 162              		.loc 1 41 57 discriminator 3 view .LVU45
 163 0062 0EF1FF33 		add	r3, lr, #-1
  41:User/Modbus/modbus_data.c ****                     }
 164              		.loc 1 41 92 discriminator 3 view .LVU46
 165 0066 40EA0420 		orr	r0, r0, r4, lsl #8
  41:User/Modbus/modbus_data.c ****                     }
 166              		.loc 1 41 64 discriminator 3 view .LVU47
 167 006a C824     		movs	r4, #200
 168 006c 04FB0323 		mla	r3, r4, r3, r2
 169 0070 074C     		ldr	r4, .L17+8
 170 0072 24F81300 		strh	r0, [r4, r3, lsl #1]	@ movhi
  39:User/Modbus/modbus_data.c ****                     {
 171              		.loc 1 39 77 is_stmt 1 discriminator 3 view .LVU48
  39:User/Modbus/modbus_data.c ****                     {
 172              		.loc 1 39 78 is_stmt 0 discriminator 3 view .LVU49
 173 0076 0132     		adds	r2, r2, #1
 174              	.LVL8:
  39:User/Modbus/modbus_data.c ****                     {
 175              		.loc 1 39 84 discriminator 3 view .LVU50
 176 0078 0231     		adds	r1, r1, #2
 177              	.LVL9:
  39:User/Modbus/modbus_data.c ****                     {
 178              		.loc 1 39 84 discriminator 3 view .LVU51
ARM GAS  /tmp/ccGXey88.s 			page 6


 179 007a EAE7     		b	.L8
 180              	.LVL10:
 181              	.L5:
  39:User/Modbus/modbus_data.c ****                     {
 182              		.loc 1 39 84 discriminator 3 view .LVU52
 183              	.LBE3:
 184              	.LBE2:
  55:User/Modbus/modbus_data.c ****             return MC_CRCERR;
 185              		.loc 1 55 13 is_stmt 1 view .LVU53
 186 007c 0548     		ldr	r0, .L17+12
 187 007e FFF7FEFF 		bl	puts
 188              	.LVL11:
  56:User/Modbus/modbus_data.c ****         }
 189              		.loc 1 56 13 view .LVU54
  56:User/Modbus/modbus_data.c ****         }
 190              		.loc 1 56 20 is_stmt 0 view .LVU55
 191 0082 0220     		movs	r0, #2
 192 0084 D7E7     		b	.L3
 193              	.L18:
 194 0086 00BF     		.align	2
 195              	.L17:
 196 0088 00000000 		.word	dma_uart2_rx
 197 008c 00000000 		.word	.LANCHOR0
 198 0090 00000000 		.word	modbus_master_hold_buf
 199 0094 00000000 		.word	.LC0
 200              		.cfi_endproc
 201              	.LFE198:
 203              		.section	.text.Modbus_Master_Read_HoldRegs,"ax",%progbits
 204              		.align	1
 205              		.global	Modbus_Master_Read_HoldRegs
 206              		.syntax unified
 207              		.thumb
 208              		.thumb_func
 209              		.fpu softvfp
 211              	Modbus_Master_Read_HoldRegs:
 212              	.LVL12:
 213              	.LFB199:
  66:User/Modbus/modbus_data.c **** 
  67:User/Modbus/modbus_data.c **** // Doc gia tri thanh ghi
  68:User/Modbus/modbus_data.c **** MB_Error_Code_t Modbus_Master_Read_HoldRegs(uint8_t id, uint16_t start_reg, uint16_t total_num, uin
  69:User/Modbus/modbus_data.c **** {
 214              		.loc 1 69 1 is_stmt 1 view -0
 215              		.cfi_startproc
 216              		@ args = 0, pretend = 0, frame = 8
 217              		@ frame_needed = 0, uses_anonymous_args = 0
 218              		.loc 1 69 1 is_stmt 0 view .LVU57
 219 0000 30B5     		push	{r4, r5, lr}
 220              	.LCFI2:
 221              		.cfi_def_cfa_offset 12
 222              		.cfi_offset 4, -12
 223              		.cfi_offset 5, -8
 224              		.cfi_offset 14, -4
 225 0002 83B0     		sub	sp, sp, #12
 226              	.LCFI3:
 227              		.cfi_def_cfa_offset 24
  70:User/Modbus/modbus_data.c ****     MB_Error_Code_t mbStatus = MB_ENOERR;
 228              		.loc 1 70 5 is_stmt 1 view .LVU58
ARM GAS  /tmp/ccGXey88.s 			page 7


 229              	.LVL13:
  71:User/Modbus/modbus_data.c **** 
  72:User/Modbus/modbus_data.c ****     switch (slave.index)
 230              		.loc 1 72 5 view .LVU59
 231              		.loc 1 72 18 is_stmt 0 view .LVU60
 232 0004 234C     		ldr	r4, .L26
 233 0006 E47A     		ldrb	r4, [r4, #11]	@ zero_extendqisi2
 234              		.loc 1 72 5 view .LVU61
 235 0008 012C     		cmp	r4, #1
 236 000a 29D0     		beq	.L20
 237 000c 022C     		cmp	r4, #2
 238 000e 3AD0     		beq	.L21
 239 0010 0CB1     		cbz	r4, .L25
 240              	.LVL14:
 241              	.L19:
  73:User/Modbus/modbus_data.c ****     {
  74:User/Modbus/modbus_data.c ****         case NOWAIT:
  75:User/Modbus/modbus_data.c ****             // transmit data
  76:User/Modbus/modbus_data.c ****             slave.id = id;
  77:User/Modbus/modbus_data.c ****             slave.reg_hold_start = start_reg;
  78:User/Modbus/modbus_data.c ****             slave.reg_hold_total = total_num;
  79:User/Modbus/modbus_data.c ****             uint8_t payload[8] = {id, R_HOLD_REGS, start_reg<<8, start_reg, total_num<<8, total_num
  80:User/Modbus/modbus_data.c ****             uint16_t i = Modbus_Create_Crc16(payload, 6);
  81:User/Modbus/modbus_data.c ****             payload[6] = (uint8_t)i;
  82:User/Modbus/modbus_data.c ****             payload[7] = (uint8_t)(i>>8);
  83:User/Modbus/modbus_data.c ****             mbStatus = Uart2_Send_Data(payload, 8);
  84:User/Modbus/modbus_data.c ****             slave.index = slave.wait = WAITING;
  85:User/Modbus/modbus_data.c ****             slave.time_out = HAL_GetTick();
  86:User/Modbus/modbus_data.c ****             break;
  87:User/Modbus/modbus_data.c ****         case WAITING:
  88:User/Modbus/modbus_data.c ****             // check time out
  89:User/Modbus/modbus_data.c ****             if(HAL_GetTick() - slave.time_out >= timeout && slave.wait == WAITING)
  90:User/Modbus/modbus_data.c ****             {
  91:User/Modbus/modbus_data.c ****                     slave.status = MB_ETIMEDOUT;
  92:User/Modbus/modbus_data.c ****                     slave.index = slave.wait = NOWAIT;
  93:User/Modbus/modbus_data.c ****                     // printf("error time out\n");
  94:User/Modbus/modbus_data.c ****                     return mbStatus;
  95:User/Modbus/modbus_data.c ****             }
  96:User/Modbus/modbus_data.c ****             break;
  97:User/Modbus/modbus_data.c ****         case WATTING_OK:
  98:User/Modbus/modbus_data.c ****             // respont data ok
  99:User/Modbus/modbus_data.c ****             slave.index = NOWAIT;
 100:User/Modbus/modbus_data.c ****             slave.status = MB_ENOERR;
 101:User/Modbus/modbus_data.c ****             return 0;
 102:User/Modbus/modbus_data.c ****         default:
 103:User/Modbus/modbus_data.c ****             break;
 104:User/Modbus/modbus_data.c ****     }
 105:User/Modbus/modbus_data.c **** }
 242              		.loc 1 105 1 view .LVU62
 243 0012 03B0     		add	sp, sp, #12
 244              	.LCFI4:
 245              		.cfi_remember_state
 246              		.cfi_def_cfa_offset 12
 247              		@ sp needed
 248 0014 30BD     		pop	{r4, r5, pc}
 249              	.LVL15:
 250              	.L25:
ARM GAS  /tmp/ccGXey88.s 			page 8


 251              	.LCFI5:
 252              		.cfi_restore_state
 253              	.LBB4:
  76:User/Modbus/modbus_data.c ****             slave.reg_hold_start = start_reg;
 254              		.loc 1 76 13 is_stmt 1 view .LVU63
  76:User/Modbus/modbus_data.c ****             slave.reg_hold_start = start_reg;
 255              		.loc 1 76 22 is_stmt 0 view .LVU64
 256 0016 1F4C     		ldr	r4, .L26
 257 0018 2070     		strb	r0, [r4]
  77:User/Modbus/modbus_data.c ****             slave.reg_hold_total = total_num;
 258              		.loc 1 77 13 is_stmt 1 view .LVU65
  77:User/Modbus/modbus_data.c ****             slave.reg_hold_total = total_num;
 259              		.loc 1 77 34 is_stmt 0 view .LVU66
 260 001a 6180     		strh	r1, [r4, #2]	@ movhi
  78:User/Modbus/modbus_data.c ****             uint8_t payload[8] = {id, R_HOLD_REGS, start_reg<<8, start_reg, total_num<<8, total_num
 261              		.loc 1 78 13 is_stmt 1 view .LVU67
  78:User/Modbus/modbus_data.c ****             uint8_t payload[8] = {id, R_HOLD_REGS, start_reg<<8, start_reg, total_num<<8, total_num
 262              		.loc 1 78 34 is_stmt 0 view .LVU68
 263 001c A280     		strh	r2, [r4, #4]	@ movhi
  79:User/Modbus/modbus_data.c ****             uint16_t i = Modbus_Create_Crc16(payload, 6);
 264              		.loc 1 79 13 is_stmt 1 view .LVU69
  79:User/Modbus/modbus_data.c ****             uint16_t i = Modbus_Create_Crc16(payload, 6);
 265              		.loc 1 79 21 is_stmt 0 view .LVU70
 266 001e 0023     		movs	r3, #0
 267              	.LVL16:
  79:User/Modbus/modbus_data.c ****             uint16_t i = Modbus_Create_Crc16(payload, 6);
 268              		.loc 1 79 21 view .LVU71
 269 0020 0093     		str	r3, [sp]
 270 0022 0193     		str	r3, [sp, #4]
 271 0024 8DF80000 		strb	r0, [sp]
 272 0028 0323     		movs	r3, #3
 273 002a 8DF80130 		strb	r3, [sp, #1]
 274 002e 8DF80310 		strb	r1, [sp, #3]
 275 0032 8DF80520 		strb	r2, [sp, #5]
  80:User/Modbus/modbus_data.c ****             payload[6] = (uint8_t)i;
 276              		.loc 1 80 13 is_stmt 1 view .LVU72
  80:User/Modbus/modbus_data.c ****             payload[6] = (uint8_t)i;
 277              		.loc 1 80 26 is_stmt 0 view .LVU73
 278 0036 0621     		movs	r1, #6
 279              	.LVL17:
  80:User/Modbus/modbus_data.c ****             payload[6] = (uint8_t)i;
 280              		.loc 1 80 26 view .LVU74
 281 0038 6846     		mov	r0, sp
 282              	.LVL18:
  80:User/Modbus/modbus_data.c ****             payload[6] = (uint8_t)i;
 283              		.loc 1 80 26 view .LVU75
 284 003a FFF7FEFF 		bl	Modbus_Create_Crc16
 285              	.LVL19:
  81:User/Modbus/modbus_data.c ****             payload[7] = (uint8_t)(i>>8);
 286              		.loc 1 81 13 is_stmt 1 view .LVU76
  81:User/Modbus/modbus_data.c ****             payload[7] = (uint8_t)(i>>8);
 287              		.loc 1 81 24 is_stmt 0 view .LVU77
 288 003e 8DF80600 		strb	r0, [sp, #6]
  82:User/Modbus/modbus_data.c ****             mbStatus = Uart2_Send_Data(payload, 8);
 289              		.loc 1 82 13 is_stmt 1 view .LVU78
  82:User/Modbus/modbus_data.c ****             mbStatus = Uart2_Send_Data(payload, 8);
 290              		.loc 1 82 26 is_stmt 0 view .LVU79
ARM GAS  /tmp/ccGXey88.s 			page 9


 291 0042 C0F30720 		ubfx	r0, r0, #8, #8
 292              	.LVL20:
  82:User/Modbus/modbus_data.c ****             mbStatus = Uart2_Send_Data(payload, 8);
 293              		.loc 1 82 24 view .LVU80
 294 0046 8DF80700 		strb	r0, [sp, #7]
  83:User/Modbus/modbus_data.c ****             slave.index = slave.wait = WAITING;
 295              		.loc 1 83 13 is_stmt 1 view .LVU81
  83:User/Modbus/modbus_data.c ****             slave.index = slave.wait = WAITING;
 296              		.loc 1 83 24 is_stmt 0 view .LVU82
 297 004a 0821     		movs	r1, #8
 298 004c 6846     		mov	r0, sp
 299 004e FFF7FEFF 		bl	Uart2_Send_Data
 300              	.LVL21:
  84:User/Modbus/modbus_data.c ****             slave.time_out = HAL_GetTick();
 301              		.loc 1 84 13 is_stmt 1 view .LVU83
  84:User/Modbus/modbus_data.c ****             slave.time_out = HAL_GetTick();
 302              		.loc 1 84 38 is_stmt 0 view .LVU84
 303 0052 0123     		movs	r3, #1
 304 0054 A372     		strb	r3, [r4, #10]
  84:User/Modbus/modbus_data.c ****             slave.time_out = HAL_GetTick();
 305              		.loc 1 84 25 view .LVU85
 306 0056 E372     		strb	r3, [r4, #11]
  85:User/Modbus/modbus_data.c ****             break;
 307              		.loc 1 85 13 is_stmt 1 view .LVU86
  85:User/Modbus/modbus_data.c ****             break;
 308              		.loc 1 85 30 is_stmt 0 view .LVU87
 309 0058 FFF7FEFF 		bl	HAL_GetTick
 310              	.LVL22:
  85:User/Modbus/modbus_data.c ****             break;
 311              		.loc 1 85 28 view .LVU88
 312 005c E080     		strh	r0, [r4, #6]	@ movhi
  86:User/Modbus/modbus_data.c ****         case WAITING:
 313              		.loc 1 86 13 is_stmt 1 view .LVU89
 314 005e D8E7     		b	.L19
 315              	.LVL23:
 316              	.L20:
  86:User/Modbus/modbus_data.c ****         case WAITING:
 317              		.loc 1 86 13 is_stmt 0 view .LVU90
 318 0060 1D46     		mov	r5, r3
  89:User/Modbus/modbus_data.c ****             {
 319              		.loc 1 89 13 is_stmt 1 view .LVU91
  89:User/Modbus/modbus_data.c ****             {
 320              		.loc 1 89 16 is_stmt 0 view .LVU92
 321 0062 FFF7FEFF 		bl	HAL_GetTick
 322              	.LVL24:
  89:User/Modbus/modbus_data.c ****             {
 323              		.loc 1 89 37 view .LVU93
 324 0066 0B4B     		ldr	r3, .L26
 325 0068 DB88     		ldrh	r3, [r3, #6]
  89:User/Modbus/modbus_data.c ****             {
 326              		.loc 1 89 30 view .LVU94
 327 006a C01A     		subs	r0, r0, r3
  89:User/Modbus/modbus_data.c ****             {
 328              		.loc 1 89 15 view .LVU95
 329 006c A842     		cmp	r0, r5
 330 006e D0D3     		bcc	.L19
  89:User/Modbus/modbus_data.c ****             {
ARM GAS  /tmp/ccGXey88.s 			page 10


 331              		.loc 1 89 66 discriminator 1 view .LVU96
 332 0070 084B     		ldr	r3, .L26
 333 0072 9B7A     		ldrb	r3, [r3, #10]	@ zero_extendqisi2
  89:User/Modbus/modbus_data.c ****             {
 334              		.loc 1 89 58 discriminator 1 view .LVU97
 335 0074 012B     		cmp	r3, #1
 336 0076 CCD1     		bne	.L19
  91:User/Modbus/modbus_data.c ****                     slave.index = slave.wait = NOWAIT;
 337              		.loc 1 91 21 is_stmt 1 view .LVU98
  91:User/Modbus/modbus_data.c ****                     slave.index = slave.wait = NOWAIT;
 338              		.loc 1 91 34 is_stmt 0 view .LVU99
 339 0078 064B     		ldr	r3, .L26
 340 007a 0322     		movs	r2, #3
 341 007c 1A81     		strh	r2, [r3, #8]	@ movhi
  92:User/Modbus/modbus_data.c ****                     // printf("error time out\n");
 342              		.loc 1 92 21 is_stmt 1 view .LVU100
  92:User/Modbus/modbus_data.c ****                     // printf("error time out\n");
 343              		.loc 1 92 46 is_stmt 0 view .LVU101
 344 007e 0022     		movs	r2, #0
 345 0080 9A72     		strb	r2, [r3, #10]
  92:User/Modbus/modbus_data.c ****                     // printf("error time out\n");
 346              		.loc 1 92 33 view .LVU102
 347 0082 DA72     		strb	r2, [r3, #11]
  94:User/Modbus/modbus_data.c ****             }
 348              		.loc 1 94 21 is_stmt 1 view .LVU103
  94:User/Modbus/modbus_data.c ****             }
 349              		.loc 1 94 28 is_stmt 0 view .LVU104
 350 0084 03E0     		b	.L23
 351              	.LVL25:
 352              	.L21:
  99:User/Modbus/modbus_data.c ****             slave.status = MB_ENOERR;
 353              		.loc 1 99 13 is_stmt 1 view .LVU105
  99:User/Modbus/modbus_data.c ****             slave.status = MB_ENOERR;
 354              		.loc 1 99 25 is_stmt 0 view .LVU106
 355 0086 034B     		ldr	r3, .L26
 356              	.LVL26:
  99:User/Modbus/modbus_data.c ****             slave.status = MB_ENOERR;
 357              		.loc 1 99 25 view .LVU107
 358 0088 0022     		movs	r2, #0
 359              	.LVL27:
  99:User/Modbus/modbus_data.c ****             slave.status = MB_ENOERR;
 360              		.loc 1 99 25 view .LVU108
 361 008a DA72     		strb	r2, [r3, #11]
 100:User/Modbus/modbus_data.c ****             return 0;
 362              		.loc 1 100 13 is_stmt 1 view .LVU109
 100:User/Modbus/modbus_data.c ****             return 0;
 363              		.loc 1 100 26 is_stmt 0 view .LVU110
 364 008c 1A81     		strh	r2, [r3, #8]	@ movhi
 101:User/Modbus/modbus_data.c ****         default:
 365              		.loc 1 101 13 is_stmt 1 view .LVU111
 366              	.LVL28:
 367              	.L23:
 101:User/Modbus/modbus_data.c ****         default:
 368              		.loc 1 101 13 is_stmt 0 view .LVU112
 369              	.LBE4:
 370              		.loc 1 105 1 discriminator 1 view .LVU113
 371 008e 0020     		movs	r0, #0
ARM GAS  /tmp/ccGXey88.s 			page 11


 372 0090 BFE7     		b	.L19
 373              	.L27:
 374 0092 00BF     		.align	2
 375              	.L26:
 376 0094 00000000 		.word	.LANCHOR0
 377              		.cfi_endproc
 378              	.LFE199:
 380              		.global	modbus_tick_timeout
 381              		.global	modbus_master_hold_buf
 382              		.global	modbus_input_buf
 383              		.global	modbus_holding_buf
 384              		.global	slave
 385              		.section	.bss.modbus_holding_buf,"aw",%nobits
 386              		.align	2
 389              	modbus_holding_buf:
 390 0000 00000000 		.space	400
 390      00000000 
 390      00000000 
 390      00000000 
 390      00000000 
 391              		.section	.bss.modbus_input_buf,"aw",%nobits
 392              		.align	2
 395              	modbus_input_buf:
 396 0000 00000000 		.space	400
 396      00000000 
 396      00000000 
 396      00000000 
 396      00000000 
 397              		.section	.bss.modbus_master_hold_buf,"aw",%nobits
 398              		.align	2
 401              	modbus_master_hold_buf:
 402 0000 00000000 		.space	6400
 402      00000000 
 402      00000000 
 402      00000000 
 402      00000000 
 403              		.section	.bss.modbus_tick_timeout,"aw",%nobits
 404              		.align	2
 407              	modbus_tick_timeout:
 408 0000 00000000 		.space	4
 409              		.section	.bss.slave,"aw",%nobits
 410              		.align	2
 411              		.set	.LANCHOR0,. + 0
 414              	slave:
 415 0000 00000000 		.space	12
 415      00000000 
 415      00000000 
 416              		.text
 417              	.Letext0:
 418              		.file 2 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stdint.h"
 419              		.file 3 "User/Modbus/modbus_data.h"
 420              		.file 4 "User/Modbus/usart.h"
 421              		.file 5 "User/Modbus/modbus_crc.h"
 422              		.file 6 "Inc/stm32f1xx_hal.h"
 423              		.file 7 "<built-in>"
ARM GAS  /tmp/ccGXey88.s 			page 12


DEFINED SYMBOLS
                            *ABS*:0000000000000000 modbus_data.c
     /tmp/ccGXey88.s:16     .text.Modbus_Master_DMA_Init:0000000000000000 $t
     /tmp/ccGXey88.s:24     .text.Modbus_Master_DMA_Init:0000000000000000 Modbus_Master_DMA_Init
     /tmp/ccGXey88.s:50     .rodata.Modbus_Master_DMA_Process.str1.4:0000000000000000 $d
     /tmp/ccGXey88.s:54     .text.Modbus_Master_DMA_Process:0000000000000000 $t
     /tmp/ccGXey88.s:61     .text.Modbus_Master_DMA_Process:0000000000000000 Modbus_Master_DMA_Process
     /tmp/ccGXey88.s:196    .text.Modbus_Master_DMA_Process:0000000000000088 $d
     /tmp/ccGXey88.s:401    .bss.modbus_master_hold_buf:0000000000000000 modbus_master_hold_buf
     /tmp/ccGXey88.s:204    .text.Modbus_Master_Read_HoldRegs:0000000000000000 $t
     /tmp/ccGXey88.s:211    .text.Modbus_Master_Read_HoldRegs:0000000000000000 Modbus_Master_Read_HoldRegs
     /tmp/ccGXey88.s:376    .text.Modbus_Master_Read_HoldRegs:0000000000000094 $d
     /tmp/ccGXey88.s:407    .bss.modbus_tick_timeout:0000000000000000 modbus_tick_timeout
     /tmp/ccGXey88.s:395    .bss.modbus_input_buf:0000000000000000 modbus_input_buf
     /tmp/ccGXey88.s:389    .bss.modbus_holding_buf:0000000000000000 modbus_holding_buf
     /tmp/ccGXey88.s:414    .bss.slave:0000000000000000 slave
     /tmp/ccGXey88.s:386    .bss.modbus_holding_buf:0000000000000000 $d
     /tmp/ccGXey88.s:392    .bss.modbus_input_buf:0000000000000000 $d
     /tmp/ccGXey88.s:398    .bss.modbus_master_hold_buf:0000000000000000 $d
     /tmp/ccGXey88.s:404    .bss.modbus_tick_timeout:0000000000000000 $d
     /tmp/ccGXey88.s:410    .bss.slave:0000000000000000 $d

UNDEFINED SYMBOLS
MX_USART2_UART_Init
Modbus_Check_Crc16
puts
dma_uart2_rx
Modbus_Create_Crc16
Uart2_Send_Data
HAL_GetTick
