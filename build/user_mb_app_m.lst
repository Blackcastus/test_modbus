ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 1


   1              		.cpu cortex-m3
   2              		.arch armv7-m
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"user_mb_app_m.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.eMBMasterRegInputCB,"ax",%progbits
  18              		.align	1
  19              		.global	eMBMasterRegInputCB
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  24              	eMBMasterRegInputCB:
  25              	.LVL0:
  26              	.LFB65:
  27              		.file 1 "FreeModbus/app/user_mb_app_m.c"
   1:FreeModbus/app/user_mb_app_m.c **** 
   2:FreeModbus/app/user_mb_app_m.c **** #include "user_mb_app_m.h"
   3:FreeModbus/app/user_mb_app_m.c **** 
   4:FreeModbus/app/user_mb_app_m.c **** #if (MB_MASTER_ASCII_ENABLED > 0 || MB_MASTER_RTU_ENABLED > 0 || MB_MASTER_TCP_ENABLED > 0)
   5:FreeModbus/app/user_mb_app_m.c **** /*-----------------------Master mode use these variables----------------------*/
   6:FreeModbus/app/user_mb_app_m.c **** #if M_DISCRETE_INPUT_NDISCRETES > 0
   7:FreeModbus/app/user_mb_app_m.c **** //Master mode:DiscreteInputs variables
   8:FreeModbus/app/user_mb_app_m.c **** USHORT   usMDiscInStart                             = M_DISCRETE_INPUT_START;
   9:FreeModbus/app/user_mb_app_m.c **** #if      M_DISCRETE_INPUT_NDISCRETES%8
  10:FreeModbus/app/user_mb_app_m.c **** UCHAR    ucMDiscInBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_DISCRETE_INPUT_NDISCRETES/8+1];
  11:FreeModbus/app/user_mb_app_m.c **** #else
  12:FreeModbus/app/user_mb_app_m.c **** UCHAR    ucMDiscInBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_DISCRETE_INPUT_NDISCRETES/8];
  13:FreeModbus/app/user_mb_app_m.c **** #endif
  14:FreeModbus/app/user_mb_app_m.c **** #endif
  15:FreeModbus/app/user_mb_app_m.c **** 
  16:FreeModbus/app/user_mb_app_m.c **** //Master mode:Coils variables
  17:FreeModbus/app/user_mb_app_m.c **** #if M_COIL_NCOILS > 0
  18:FreeModbus/app/user_mb_app_m.c **** USHORT   usMCoilStart                               = M_COIL_START;
  19:FreeModbus/app/user_mb_app_m.c **** #if      M_COIL_NCOILS%8
  20:FreeModbus/app/user_mb_app_m.c **** UCHAR    ucMCoilBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_COIL_NCOILS/8+1];
  21:FreeModbus/app/user_mb_app_m.c **** #else
  22:FreeModbus/app/user_mb_app_m.c **** UCHAR    ucMCoilBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_COIL_NCOILS/8];
  23:FreeModbus/app/user_mb_app_m.c **** #endif
  24:FreeModbus/app/user_mb_app_m.c **** #endif
  25:FreeModbus/app/user_mb_app_m.c **** 
  26:FreeModbus/app/user_mb_app_m.c **** //Master mode:InputRegister variables
  27:FreeModbus/app/user_mb_app_m.c **** #if M_REG_INPUT_NREGS > 0
  28:FreeModbus/app/user_mb_app_m.c **** USHORT   usMRegInStart                              = M_REG_INPUT_START;
  29:FreeModbus/app/user_mb_app_m.c **** USHORT   usMRegInBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_REG_INPUT_NREGS];
  30:FreeModbus/app/user_mb_app_m.c **** #endif
  31:FreeModbus/app/user_mb_app_m.c **** 
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 2


  32:FreeModbus/app/user_mb_app_m.c **** //Master mode:HoldingRegister variables
  33:FreeModbus/app/user_mb_app_m.c **** #if M_REG_HOLDING_NREGS > 0
  34:FreeModbus/app/user_mb_app_m.c **** USHORT   usMRegHoldStart                            = M_REG_HOLDING_START;
  35:FreeModbus/app/user_mb_app_m.c **** USHORT   usMRegHoldBuf[MB_MASTER_TOTAL_SLAVE_NUM][M_REG_HOLDING_NREGS];
  36:FreeModbus/app/user_mb_app_m.c **** #endif
  37:FreeModbus/app/user_mb_app_m.c **** 
  38:FreeModbus/app/user_mb_app_m.c **** /**
  39:FreeModbus/app/user_mb_app_m.c ****  * Modbus master input register callback function.
  40:FreeModbus/app/user_mb_app_m.c ****  *
  41:FreeModbus/app/user_mb_app_m.c ****  * @param pucRegBuffer input register buffer
  42:FreeModbus/app/user_mb_app_m.c ****  * @param usAddress input register address
  43:FreeModbus/app/user_mb_app_m.c ****  * @param usNRegs input register number
  44:FreeModbus/app/user_mb_app_m.c ****  *
  45:FreeModbus/app/user_mb_app_m.c ****  * @return result
  46:FreeModbus/app/user_mb_app_m.c ****  */
  47:FreeModbus/app/user_mb_app_m.c **** eMBErrorCode eMBMasterRegInputCB( UCHAR * pucRegBuffer, USHORT usAddress, USHORT usNRegs )
  48:FreeModbus/app/user_mb_app_m.c **** {
  28              		.loc 1 48 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 48 1 is_stmt 0 view .LVU1
  33 0000 70B5     		push	{r4, r5, r6, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 16
  36              		.cfi_offset 4, -16
  37              		.cfi_offset 5, -12
  38              		.cfi_offset 6, -8
  39              		.cfi_offset 14, -4
  40 0002 0646     		mov	r6, r0
  41 0004 0C46     		mov	r4, r1
  42 0006 1546     		mov	r5, r2
  49:FreeModbus/app/user_mb_app_m.c **** #if M_REG_INPUT_NREGS > 0
  50:FreeModbus/app/user_mb_app_m.c ****     eMBErrorCode    eStatus = MB_ENOERR;
  43              		.loc 1 50 5 is_stmt 1 view .LVU2
  44              	.LVL1:
  51:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex;
  45              		.loc 1 51 5 view .LVU3
  52:FreeModbus/app/user_mb_app_m.c ****     USHORT *        pusRegInputBuf;
  46              		.loc 1 52 5 view .LVU4
  53:FreeModbus/app/user_mb_app_m.c ****     USHORT          REG_INPUT_START;
  47              		.loc 1 53 5 view .LVU5
  54:FreeModbus/app/user_mb_app_m.c ****     USHORT          REG_INPUT_NREGS;
  48              		.loc 1 54 5 view .LVU6
  55:FreeModbus/app/user_mb_app_m.c ****     USHORT          usRegInStart;
  49              		.loc 1 55 5 view .LVU7
  56:FreeModbus/app/user_mb_app_m.c **** 
  57:FreeModbus/app/user_mb_app_m.c ****     pusRegInputBuf = usMRegInBuf[ucMBMasterGetDestAddress() - 1];
  50              		.loc 1 57 5 view .LVU8
  51              		.loc 1 57 34 is_stmt 0 view .LVU9
  52 0008 FFF7FEFF 		bl	ucMBMasterGetDestAddress
  53              	.LVL2:
  54              		.loc 1 57 61 view .LVU10
  55 000c 0138     		subs	r0, r0, #1
  56              		.loc 1 57 20 view .LVU11
  57 000e 114B     		ldr	r3, .L7
  58 0010 03EB401C 		add	ip, r3, r0, lsl #5
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 3


  59              	.LVL3:
  58:FreeModbus/app/user_mb_app_m.c ****     REG_INPUT_START = M_REG_INPUT_START;
  60              		.loc 1 58 5 is_stmt 1 view .LVU12
  59:FreeModbus/app/user_mb_app_m.c ****     REG_INPUT_NREGS = M_REG_INPUT_NREGS;
  61              		.loc 1 59 5 view .LVU13
  60:FreeModbus/app/user_mb_app_m.c ****     usRegInStart = usMRegInStart;
  62              		.loc 1 60 5 view .LVU14
  63              		.loc 1 60 18 is_stmt 0 view .LVU15
  64 0014 104B     		ldr	r3, .L7+4
  65 0016 1988     		ldrh	r1, [r3]
  66              	.LVL4:
  61:FreeModbus/app/user_mb_app_m.c **** 
  62:FreeModbus/app/user_mb_app_m.c ****     /* it already plus one in modbus function method. */
  63:FreeModbus/app/user_mb_app_m.c ****     usAddress--;
  67              		.loc 1 63 5 is_stmt 1 view .LVU16
  68              		.loc 1 63 14 is_stmt 0 view .LVU17
  69 0018 631E     		subs	r3, r4, #1
  70 001a 9BB2     		uxth	r3, r3
  71              	.LVL5:
  64:FreeModbus/app/user_mb_app_m.c **** 
  65:FreeModbus/app/user_mb_app_m.c ****     if ((usAddress >= REG_INPUT_START) && (usAddress + usNRegs <= REG_INPUT_START + REG_INPUT_NREGS
  72              		.loc 1 65 5 is_stmt 1 view .LVU18
  73              		.loc 1 65 54 is_stmt 0 view .LVU19
  74 001c 5A19     		adds	r2, r3, r5
  75              		.loc 1 65 40 view .LVU20
  76 001e 102A     		cmp	r2, #16
  77 0020 15DC     		bgt	.L5
  66:FreeModbus/app/user_mb_app_m.c ****     {
  67:FreeModbus/app/user_mb_app_m.c ****         iRegIndex = usAddress - usRegInStart;
  78              		.loc 1 67 9 is_stmt 1 view .LVU21
  79              		.loc 1 67 19 is_stmt 0 view .LVU22
  80 0022 5B1A     		subs	r3, r3, r1
  81              	.LVL6:
  82              		.loc 1 67 19 view .LVU23
  83 0024 9BB2     		uxth	r3, r3
  84              	.LVL7:
  68:FreeModbus/app/user_mb_app_m.c ****         while (usNRegs > 0)
  85              		.loc 1 68 9 is_stmt 1 view .LVU24
  86              		.loc 1 68 15 is_stmt 0 view .LVU25
  87 0026 0EE0     		b	.L3
  88              	.LVL8:
  89              	.L4:
  69:FreeModbus/app/user_mb_app_m.c ****         {
  70:FreeModbus/app/user_mb_app_m.c ****             pusRegInputBuf[iRegIndex] = *pucRegBuffer++ << 8;
  90              		.loc 1 70 13 is_stmt 1 view .LVU26
  91              		.loc 1 70 41 is_stmt 0 view .LVU27
  92 0028 3046     		mov	r0, r6
  93 002a 10F8021B 		ldrb	r1, [r0], #2	@ zero_extendqisi2
  94              		.loc 1 70 57 view .LVU28
  95 002e 0902     		lsls	r1, r1, #8
  96              		.loc 1 70 39 view .LVU29
  97 0030 2CF81310 		strh	r1, [ip, r3, lsl #1]	@ movhi
  71:FreeModbus/app/user_mb_app_m.c ****             pusRegInputBuf[iRegIndex] |= *pucRegBuffer++;
  98              		.loc 1 71 13 is_stmt 1 view .LVU30
  99              	.LVL9:
 100              		.loc 1 71 42 is_stmt 0 view .LVU31
 101 0034 7278     		ldrb	r2, [r6, #1]	@ zero_extendqisi2
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 4


 102              		.loc 1 71 39 view .LVU32
 103 0036 1143     		orrs	r1, r1, r2
 104 0038 2CF81310 		strh	r1, [ip, r3, lsl #1]	@ movhi
  72:FreeModbus/app/user_mb_app_m.c ****             iRegIndex++;
 105              		.loc 1 72 13 is_stmt 1 view .LVU33
 106              		.loc 1 72 22 is_stmt 0 view .LVU34
 107 003c 0133     		adds	r3, r3, #1
 108              	.LVL10:
 109              		.loc 1 72 22 view .LVU35
 110 003e 9BB2     		uxth	r3, r3
 111              	.LVL11:
  73:FreeModbus/app/user_mb_app_m.c ****             usNRegs--;
 112              		.loc 1 73 13 is_stmt 1 view .LVU36
 113              		.loc 1 73 20 is_stmt 0 view .LVU37
 114 0040 013D     		subs	r5, r5, #1
 115              	.LVL12:
 116              		.loc 1 73 20 view .LVU38
 117 0042 ADB2     		uxth	r5, r5
 118              	.LVL13:
  71:FreeModbus/app/user_mb_app_m.c ****             pusRegInputBuf[iRegIndex] |= *pucRegBuffer++;
 119              		.loc 1 71 55 view .LVU39
 120 0044 0646     		mov	r6, r0
 121              	.LVL14:
 122              	.L3:
  68:FreeModbus/app/user_mb_app_m.c ****         {
 123              		.loc 1 68 15 is_stmt 1 view .LVU40
 124 0046 002D     		cmp	r5, #0
 125 0048 EED1     		bne	.L4
  50:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex;
 126              		.loc 1 50 21 is_stmt 0 view .LVU41
 127 004a 0020     		movs	r0, #0
 128              	.LVL15:
 129              	.L2:
  74:FreeModbus/app/user_mb_app_m.c ****         }
  75:FreeModbus/app/user_mb_app_m.c ****     }
  76:FreeModbus/app/user_mb_app_m.c ****     else
  77:FreeModbus/app/user_mb_app_m.c ****     {
  78:FreeModbus/app/user_mb_app_m.c ****         eStatus = MB_ENOREG;
  79:FreeModbus/app/user_mb_app_m.c ****     }
  80:FreeModbus/app/user_mb_app_m.c **** 
  81:FreeModbus/app/user_mb_app_m.c ****     return eStatus;
 130              		.loc 1 81 5 is_stmt 1 view .LVU42
  82:FreeModbus/app/user_mb_app_m.c **** #else
  83:FreeModbus/app/user_mb_app_m.c **** 	return MB_ENOREG;
  84:FreeModbus/app/user_mb_app_m.c **** #endif
  85:FreeModbus/app/user_mb_app_m.c **** }
 131              		.loc 1 85 1 is_stmt 0 view .LVU43
 132 004c 70BD     		pop	{r4, r5, r6, pc}
 133              	.LVL16:
 134              	.L5:
  78:FreeModbus/app/user_mb_app_m.c ****     }
 135              		.loc 1 78 17 view .LVU44
 136 004e 0120     		movs	r0, #1
 137 0050 FCE7     		b	.L2
 138              	.L8:
 139 0052 00BF     		.align	2
 140              	.L7:
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 5


 141 0054 00000000 		.word	.LANCHOR0
 142 0058 00000000 		.word	.LANCHOR1
 143              		.cfi_endproc
 144              	.LFE65:
 146              		.section	.text.eMBMasterRegHoldingCB,"ax",%progbits
 147              		.align	1
 148              		.global	eMBMasterRegHoldingCB
 149              		.syntax unified
 150              		.thumb
 151              		.thumb_func
 153              	eMBMasterRegHoldingCB:
 154              	.LVL17:
 155              	.LFB66:
  86:FreeModbus/app/user_mb_app_m.c **** 
  87:FreeModbus/app/user_mb_app_m.c **** /**
  88:FreeModbus/app/user_mb_app_m.c ****  * Modbus master holding register callback function.
  89:FreeModbus/app/user_mb_app_m.c ****  *
  90:FreeModbus/app/user_mb_app_m.c ****  * @param pucRegBuffer holding register buffer
  91:FreeModbus/app/user_mb_app_m.c ****  * @param usAddress holding register address
  92:FreeModbus/app/user_mb_app_m.c ****  * @param usNRegs holding register number
  93:FreeModbus/app/user_mb_app_m.c ****  * @param eMode read or write
  94:FreeModbus/app/user_mb_app_m.c ****  *
  95:FreeModbus/app/user_mb_app_m.c ****  * @return result
  96:FreeModbus/app/user_mb_app_m.c ****  */
  97:FreeModbus/app/user_mb_app_m.c **** eMBErrorCode eMBMasterRegHoldingCB(UCHAR * pucRegBuffer, USHORT usAddress, USHORT usNRegs, eMBRegis
  98:FreeModbus/app/user_mb_app_m.c **** {
 156              		.loc 1 98 1 is_stmt 1 view -0
 157              		.cfi_startproc
 158              		@ args = 0, pretend = 0, frame = 0
 159              		@ frame_needed = 0, uses_anonymous_args = 0
 160              		.loc 1 98 1 is_stmt 0 view .LVU46
 161 0000 70B5     		push	{r4, r5, r6, lr}
 162              	.LCFI1:
 163              		.cfi_def_cfa_offset 16
 164              		.cfi_offset 4, -16
 165              		.cfi_offset 5, -12
 166              		.cfi_offset 6, -8
 167              		.cfi_offset 14, -4
 168 0002 0646     		mov	r6, r0
 169 0004 0C46     		mov	r4, r1
 170 0006 1546     		mov	r5, r2
  99:FreeModbus/app/user_mb_app_m.c **** #if M_REG_HOLDING_NREGS > 0
 100:FreeModbus/app/user_mb_app_m.c ****     eMBErrorCode    eStatus = MB_ENOERR;
 171              		.loc 1 100 5 is_stmt 1 view .LVU47
 172              	.LVL18:
 101:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex;
 173              		.loc 1 101 5 view .LVU48
 102:FreeModbus/app/user_mb_app_m.c ****     USHORT *        pusRegHoldingBuf;
 174              		.loc 1 102 5 view .LVU49
 103:FreeModbus/app/user_mb_app_m.c ****     USHORT          REG_HOLDING_START;
 175              		.loc 1 103 5 view .LVU50
 104:FreeModbus/app/user_mb_app_m.c ****     USHORT          REG_HOLDING_NREGS;
 176              		.loc 1 104 5 view .LVU51
 105:FreeModbus/app/user_mb_app_m.c ****     USHORT          usRegHoldStart;
 177              		.loc 1 105 5 view .LVU52
 106:FreeModbus/app/user_mb_app_m.c **** 
 107:FreeModbus/app/user_mb_app_m.c ****     pusRegHoldingBuf = usMRegHoldBuf[ucMBMasterGetDestAddress() - 1];
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 6


 178              		.loc 1 107 5 view .LVU53
 179              		.loc 1 107 38 is_stmt 0 view .LVU54
 180 0008 FFF7FEFF 		bl	ucMBMasterGetDestAddress
 181              	.LVL19:
 182              		.loc 1 107 65 view .LVU55
 183 000c 0138     		subs	r0, r0, #1
 184              		.loc 1 107 22 view .LVU56
 185 000e 124B     		ldr	r3, .L15
 186 0010 4FF0C80C 		mov	ip, #200
 187 0014 0CFB003C 		mla	ip, ip, r0, r3
 188              	.LVL20:
 108:FreeModbus/app/user_mb_app_m.c ****     REG_HOLDING_START = M_REG_HOLDING_START;
 189              		.loc 1 108 5 is_stmt 1 view .LVU57
 109:FreeModbus/app/user_mb_app_m.c ****     REG_HOLDING_NREGS = M_REG_HOLDING_NREGS;
 190              		.loc 1 109 5 view .LVU58
 110:FreeModbus/app/user_mb_app_m.c ****     usRegHoldStart = usMRegHoldStart;
 191              		.loc 1 110 5 view .LVU59
 192              		.loc 1 110 20 is_stmt 0 view .LVU60
 193 0018 104B     		ldr	r3, .L15+4
 194 001a 1988     		ldrh	r1, [r3]
 195              	.LVL21:
 111:FreeModbus/app/user_mb_app_m.c ****     /* if mode is read, the master will write the received date to buffer. */
 112:FreeModbus/app/user_mb_app_m.c ****     eMode = MB_REG_WRITE;
 196              		.loc 1 112 5 is_stmt 1 view .LVU61
 113:FreeModbus/app/user_mb_app_m.c **** 
 114:FreeModbus/app/user_mb_app_m.c ****     /* it already plus one in modbus function method. */
 115:FreeModbus/app/user_mb_app_m.c ****     usAddress--;
 197              		.loc 1 115 5 view .LVU62
 198              		.loc 1 115 14 is_stmt 0 view .LVU63
 199 001c 631E     		subs	r3, r4, #1
 200 001e 9BB2     		uxth	r3, r3
 201              	.LVL22:
 116:FreeModbus/app/user_mb_app_m.c **** 
 117:FreeModbus/app/user_mb_app_m.c ****     if ((usAddress >= REG_HOLDING_START) && (usAddress + usNRegs <= REG_HOLDING_START + REG_HOLDING
 202              		.loc 1 117 5 is_stmt 1 view .LVU64
 203              		.loc 1 117 56 is_stmt 0 view .LVU65
 204 0020 5A19     		adds	r2, r3, r5
 205              		.loc 1 117 42 view .LVU66
 206 0022 642A     		cmp	r2, #100
 207 0024 15DC     		bgt	.L13
 118:FreeModbus/app/user_mb_app_m.c ****     {
 119:FreeModbus/app/user_mb_app_m.c ****         iRegIndex = usAddress - usRegHoldStart;
 208              		.loc 1 119 9 is_stmt 1 view .LVU67
 209              		.loc 1 119 19 is_stmt 0 view .LVU68
 210 0026 5B1A     		subs	r3, r3, r1
 211              	.LVL23:
 212              		.loc 1 119 19 view .LVU69
 213 0028 9BB2     		uxth	r3, r3
 214              	.LVL24:
 120:FreeModbus/app/user_mb_app_m.c ****         switch (eMode)
 215              		.loc 1 120 9 is_stmt 1 view .LVU70
 216 002a 0EE0     		b	.L11
 217              	.LVL25:
 218              	.L12:
 121:FreeModbus/app/user_mb_app_m.c ****         {
 122:FreeModbus/app/user_mb_app_m.c ****         /* read current register values from the protocol stack. */
 123:FreeModbus/app/user_mb_app_m.c ****         case MB_REG_READ:
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 7


 124:FreeModbus/app/user_mb_app_m.c ****             while (usNRegs > 0)
 125:FreeModbus/app/user_mb_app_m.c ****             {
 126:FreeModbus/app/user_mb_app_m.c ****                 *pucRegBuffer++ = (UCHAR) (pusRegHoldingBuf[iRegIndex] >> 8);
 127:FreeModbus/app/user_mb_app_m.c ****                 *pucRegBuffer++ = (UCHAR) (pusRegHoldingBuf[iRegIndex] & 0xFF);
 128:FreeModbus/app/user_mb_app_m.c ****                 iRegIndex++;
 129:FreeModbus/app/user_mb_app_m.c ****                 usNRegs--;
 130:FreeModbus/app/user_mb_app_m.c ****             }
 131:FreeModbus/app/user_mb_app_m.c ****             break;
 132:FreeModbus/app/user_mb_app_m.c ****         /* write current register values with new values from the protocol stack. */
 133:FreeModbus/app/user_mb_app_m.c ****         case MB_REG_WRITE:
 134:FreeModbus/app/user_mb_app_m.c ****             while (usNRegs > 0)
 135:FreeModbus/app/user_mb_app_m.c ****             {
 136:FreeModbus/app/user_mb_app_m.c ****                 pusRegHoldingBuf[iRegIndex] = *pucRegBuffer++ << 8;
 219              		.loc 1 136 17 view .LVU71
 220              		.loc 1 136 47 is_stmt 0 view .LVU72
 221 002c 3046     		mov	r0, r6
 222 002e 10F8021B 		ldrb	r1, [r0], #2	@ zero_extendqisi2
 223              		.loc 1 136 63 view .LVU73
 224 0032 0902     		lsls	r1, r1, #8
 225              		.loc 1 136 45 view .LVU74
 226 0034 2CF81310 		strh	r1, [ip, r3, lsl #1]	@ movhi
 137:FreeModbus/app/user_mb_app_m.c ****                 pusRegHoldingBuf[iRegIndex] |= *pucRegBuffer++;
 227              		.loc 1 137 17 is_stmt 1 view .LVU75
 228              	.LVL26:
 229              		.loc 1 137 48 is_stmt 0 view .LVU76
 230 0038 7278     		ldrb	r2, [r6, #1]	@ zero_extendqisi2
 231              		.loc 1 137 45 view .LVU77
 232 003a 1143     		orrs	r1, r1, r2
 233 003c 2CF81310 		strh	r1, [ip, r3, lsl #1]	@ movhi
 138:FreeModbus/app/user_mb_app_m.c ****                 iRegIndex++;
 234              		.loc 1 138 17 is_stmt 1 view .LVU78
 235              		.loc 1 138 26 is_stmt 0 view .LVU79
 236 0040 0133     		adds	r3, r3, #1
 237              	.LVL27:
 238              		.loc 1 138 26 view .LVU80
 239 0042 9BB2     		uxth	r3, r3
 240              	.LVL28:
 139:FreeModbus/app/user_mb_app_m.c ****                 usNRegs--;
 241              		.loc 1 139 17 is_stmt 1 view .LVU81
 242              		.loc 1 139 24 is_stmt 0 view .LVU82
 243 0044 013D     		subs	r5, r5, #1
 244              	.LVL29:
 245              		.loc 1 139 24 view .LVU83
 246 0046 ADB2     		uxth	r5, r5
 247              	.LVL30:
 137:FreeModbus/app/user_mb_app_m.c ****                 pusRegHoldingBuf[iRegIndex] |= *pucRegBuffer++;
 248              		.loc 1 137 61 view .LVU84
 249 0048 0646     		mov	r6, r0
 250              	.LVL31:
 251              	.L11:
 134:FreeModbus/app/user_mb_app_m.c ****             {
 252              		.loc 1 134 19 is_stmt 1 view .LVU85
 253 004a 002D     		cmp	r5, #0
 254 004c EED1     		bne	.L12
 100:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex;
 255              		.loc 1 100 21 is_stmt 0 view .LVU86
 256 004e 0020     		movs	r0, #0
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 8


 257              	.LVL32:
 258              	.L10:
 140:FreeModbus/app/user_mb_app_m.c ****             }
 141:FreeModbus/app/user_mb_app_m.c ****             break;
 142:FreeModbus/app/user_mb_app_m.c ****         }
 143:FreeModbus/app/user_mb_app_m.c ****     }
 144:FreeModbus/app/user_mb_app_m.c ****     else
 145:FreeModbus/app/user_mb_app_m.c ****     {
 146:FreeModbus/app/user_mb_app_m.c ****         eStatus = MB_ENOREG;
 147:FreeModbus/app/user_mb_app_m.c ****     }
 148:FreeModbus/app/user_mb_app_m.c ****     return eStatus;
 259              		.loc 1 148 5 is_stmt 1 view .LVU87
 149:FreeModbus/app/user_mb_app_m.c **** #else
 150:FreeModbus/app/user_mb_app_m.c **** 	return MB_ENOREG;
 151:FreeModbus/app/user_mb_app_m.c **** #endif
 152:FreeModbus/app/user_mb_app_m.c **** }
 260              		.loc 1 152 1 is_stmt 0 view .LVU88
 261 0050 70BD     		pop	{r4, r5, r6, pc}
 262              	.LVL33:
 263              	.L13:
 146:FreeModbus/app/user_mb_app_m.c ****     }
 264              		.loc 1 146 17 view .LVU89
 265 0052 0120     		movs	r0, #1
 266 0054 FCE7     		b	.L10
 267              	.L16:
 268 0056 00BF     		.align	2
 269              	.L15:
 270 0058 00000000 		.word	.LANCHOR2
 271 005c 00000000 		.word	.LANCHOR3
 272              		.cfi_endproc
 273              	.LFE66:
 275              		.section	.text.eMBMasterRegCoilsCB,"ax",%progbits
 276              		.align	1
 277              		.global	eMBMasterRegCoilsCB
 278              		.syntax unified
 279              		.thumb
 280              		.thumb_func
 282              	eMBMasterRegCoilsCB:
 283              	.LVL34:
 284              	.LFB67:
 153:FreeModbus/app/user_mb_app_m.c **** 
 154:FreeModbus/app/user_mb_app_m.c **** /**
 155:FreeModbus/app/user_mb_app_m.c ****  * Modbus master coils callback function.
 156:FreeModbus/app/user_mb_app_m.c ****  *
 157:FreeModbus/app/user_mb_app_m.c ****  * @param pucRegBuffer coils buffer
 158:FreeModbus/app/user_mb_app_m.c ****  * @param usAddress coils address
 159:FreeModbus/app/user_mb_app_m.c ****  * @param usNCoils coils number
 160:FreeModbus/app/user_mb_app_m.c ****  * @param eMode read or write
 161:FreeModbus/app/user_mb_app_m.c ****  *
 162:FreeModbus/app/user_mb_app_m.c ****  * @return result
 163:FreeModbus/app/user_mb_app_m.c ****  */
 164:FreeModbus/app/user_mb_app_m.c **** eMBErrorCode eMBMasterRegCoilsCB(UCHAR * pucRegBuffer, USHORT usAddress, USHORT usNCoils, eMBRegist
 165:FreeModbus/app/user_mb_app_m.c **** {
 285              		.loc 1 165 1 is_stmt 1 view -0
 286              		.cfi_startproc
 287              		@ args = 0, pretend = 0, frame = 0
 288              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 9


 289              		.loc 1 165 1 is_stmt 0 view .LVU91
 290 0000 2DE9F843 		push	{r3, r4, r5, r6, r7, r8, r9, lr}
 291              	.LCFI2:
 292              		.cfi_def_cfa_offset 32
 293              		.cfi_offset 3, -32
 294              		.cfi_offset 4, -28
 295              		.cfi_offset 5, -24
 296              		.cfi_offset 6, -20
 297              		.cfi_offset 7, -16
 298              		.cfi_offset 8, -12
 299              		.cfi_offset 9, -8
 300              		.cfi_offset 14, -4
 301 0004 0446     		mov	r4, r0
 302 0006 0F46     		mov	r7, r1
 303 0008 9146     		mov	r9, r2
 166:FreeModbus/app/user_mb_app_m.c **** #if M_COIL_NCOILS > 0
 167:FreeModbus/app/user_mb_app_m.c ****     eMBErrorCode    eStatus = MB_ENOERR;
 304              		.loc 1 167 5 is_stmt 1 view .LVU92
 305              	.LVL35:
 168:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 306              		.loc 1 168 5 view .LVU93
 169:FreeModbus/app/user_mb_app_m.c ****     UCHAR *         pucCoilBuf;
 307              		.loc 1 169 5 view .LVU94
 170:FreeModbus/app/user_mb_app_m.c ****     USHORT          COIL_START;
 308              		.loc 1 170 5 view .LVU95
 171:FreeModbus/app/user_mb_app_m.c ****     USHORT          COIL_NCOILS;
 309              		.loc 1 171 5 view .LVU96
 172:FreeModbus/app/user_mb_app_m.c ****     USHORT          usCoilStart;
 310              		.loc 1 172 5 view .LVU97
 173:FreeModbus/app/user_mb_app_m.c ****     iNReg =  usNCoils / 8 + 1;
 311              		.loc 1 173 5 view .LVU98
 312              		.loc 1 173 27 is_stmt 0 view .LVU99
 313 000a D508     		lsrs	r5, r2, #3
 314              	.LVL36:
 174:FreeModbus/app/user_mb_app_m.c **** 
 175:FreeModbus/app/user_mb_app_m.c ****     pucCoilBuf = ucMCoilBuf[ucMBMasterGetDestAddress() - 1];
 315              		.loc 1 175 5 is_stmt 1 view .LVU100
 316              		.loc 1 175 29 is_stmt 0 view .LVU101
 317 000c FFF7FEFF 		bl	ucMBMasterGetDestAddress
 318              	.LVL37:
 319              		.loc 1 175 56 view .LVU102
 320 0010 0138     		subs	r0, r0, #1
 321              		.loc 1 175 16 view .LVU103
 322 0012 174B     		ldr	r3, .L25
 323 0014 03EB4008 		add	r8, r3, r0, lsl #1
 324              	.LVL38:
 176:FreeModbus/app/user_mb_app_m.c ****     COIL_START = M_COIL_START;
 325              		.loc 1 176 5 is_stmt 1 view .LVU104
 177:FreeModbus/app/user_mb_app_m.c ****     COIL_NCOILS = M_COIL_NCOILS;
 326              		.loc 1 177 5 view .LVU105
 178:FreeModbus/app/user_mb_app_m.c ****     usCoilStart = usMCoilStart;
 327              		.loc 1 178 5 view .LVU106
 328              		.loc 1 178 17 is_stmt 0 view .LVU107
 329 0018 164B     		ldr	r3, .L25+4
 330 001a 1A88     		ldrh	r2, [r3]
 331              	.LVL39:
 179:FreeModbus/app/user_mb_app_m.c **** 
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 10


 180:FreeModbus/app/user_mb_app_m.c ****     /* if mode is read,the master will write the received date to buffer. */
 181:FreeModbus/app/user_mb_app_m.c ****     eMode = MB_REG_WRITE;
 332              		.loc 1 181 5 is_stmt 1 view .LVU108
 182:FreeModbus/app/user_mb_app_m.c **** 
 183:FreeModbus/app/user_mb_app_m.c ****     /* it already plus one in modbus function method. */
 184:FreeModbus/app/user_mb_app_m.c ****     usAddress--;
 333              		.loc 1 184 5 view .LVU109
 334              		.loc 1 184 14 is_stmt 0 view .LVU110
 335 001c 013F     		subs	r7, r7, #1
 336 001e BFB2     		uxth	r7, r7
 337              	.LVL40:
 185:FreeModbus/app/user_mb_app_m.c **** 
 186:FreeModbus/app/user_mb_app_m.c ****     if ((usAddress >= COIL_START) && (usAddress + usNCoils <= COIL_START + COIL_NCOILS))
 338              		.loc 1 186 5 is_stmt 1 view .LVU111
 339              		.loc 1 186 49 is_stmt 0 view .LVU112
 340 0020 07EB0903 		add	r3, r7, r9
 341              		.loc 1 186 35 view .LVU113
 342 0024 102B     		cmp	r3, #16
 343 0026 20DC     		bgt	.L21
 344 0028 0135     		adds	r5, r5, #1
 345              	.LVL41:
 187:FreeModbus/app/user_mb_app_m.c ****     {
 188:FreeModbus/app/user_mb_app_m.c ****         iRegIndex = (USHORT) (usAddress - usCoilStart) / 8;
 346              		.loc 1 188 9 is_stmt 1 view .LVU114
 347              		.loc 1 188 21 is_stmt 0 view .LVU115
 348 002a BF1A     		subs	r7, r7, r2
 349              	.LVL42:
 350              		.loc 1 188 19 view .LVU116
 351 002c C7F3CC00 		ubfx	r0, r7, #3, #13
 352              	.LVL43:
 189:FreeModbus/app/user_mb_app_m.c ****         iRegBitIndex = (USHORT) (usAddress - usCoilStart) % 8;
 353              		.loc 1 189 9 is_stmt 1 view .LVU117
 354              		.loc 1 189 22 is_stmt 0 view .LVU118
 355 0030 07F00707 		and	r7, r7, #7
 356              	.LVL44:
 190:FreeModbus/app/user_mb_app_m.c ****         switch (eMode)
 357              		.loc 1 190 9 is_stmt 1 view .LVU119
 358 0034 0BE0     		b	.L19
 359              	.LVL45:
 360              	.L20:
 191:FreeModbus/app/user_mb_app_m.c ****         {
 192:FreeModbus/app/user_mb_app_m.c ****          /* read current coil values from the protocol stack. */
 193:FreeModbus/app/user_mb_app_m.c ****         case MB_REG_READ:
 194:FreeModbus/app/user_mb_app_m.c ****             while (iNReg > 0)
 195:FreeModbus/app/user_mb_app_m.c ****             {
 196:FreeModbus/app/user_mb_app_m.c ****                 *pucRegBuffer++ = xMBUtilGetBits(&pucCoilBuf[iRegIndex++],
 197:FreeModbus/app/user_mb_app_m.c ****                         iRegBitIndex, 8);
 198:FreeModbus/app/user_mb_app_m.c ****                 iNReg--;
 199:FreeModbus/app/user_mb_app_m.c ****             }
 200:FreeModbus/app/user_mb_app_m.c ****             pucRegBuffer--;
 201:FreeModbus/app/user_mb_app_m.c ****             /* last coils */
 202:FreeModbus/app/user_mb_app_m.c ****             usNCoils = usNCoils % 8;
 203:FreeModbus/app/user_mb_app_m.c ****             /* filling zero to high bit */
 204:FreeModbus/app/user_mb_app_m.c ****             *pucRegBuffer = *pucRegBuffer << (8 - usNCoils);
 205:FreeModbus/app/user_mb_app_m.c ****             *pucRegBuffer = *pucRegBuffer >> (8 - usNCoils);
 206:FreeModbus/app/user_mb_app_m.c ****             break;
 207:FreeModbus/app/user_mb_app_m.c **** 
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 11


 208:FreeModbus/app/user_mb_app_m.c ****         /* write current coil values with new values from the protocol stack. */
 209:FreeModbus/app/user_mb_app_m.c ****         case MB_REG_WRITE:
 210:FreeModbus/app/user_mb_app_m.c ****             while (iNReg > 1)
 211:FreeModbus/app/user_mb_app_m.c ****             {
 212:FreeModbus/app/user_mb_app_m.c ****                 xMBUtilSetBits(&pucCoilBuf[iRegIndex++], iRegBitIndex, 8,
 361              		.loc 1 212 17 view .LVU120
 362              		.loc 1 212 53 is_stmt 0 view .LVU121
 363 0036 461C     		adds	r6, r0, #1
 364 0038 B6B2     		uxth	r6, r6
 365              	.LVL46:
 366              		.loc 1 212 17 view .LVU122
 367 003a 14F8013B 		ldrb	r3, [r4], #1	@ zero_extendqisi2
 368              	.LVL47:
 369              		.loc 1 212 17 view .LVU123
 370 003e 0822     		movs	r2, #8
 371 0040 3946     		mov	r1, r7
 372 0042 4044     		add	r0, r0, r8
 373 0044 FFF7FEFF 		bl	xMBUtilSetBits
 374              	.LVL48:
 213:FreeModbus/app/user_mb_app_m.c ****                         *pucRegBuffer++);
 214:FreeModbus/app/user_mb_app_m.c ****                 iNReg--;
 375              		.loc 1 214 17 is_stmt 1 view .LVU124
 376              		.loc 1 214 22 is_stmt 0 view .LVU125
 377 0048 013D     		subs	r5, r5, #1
 378              	.LVL49:
 379              		.loc 1 214 22 view .LVU126
 380 004a ADB2     		uxth	r5, r5
 381              	.LVL50:
 212:FreeModbus/app/user_mb_app_m.c ****                         *pucRegBuffer++);
 382              		.loc 1 212 53 view .LVU127
 383 004c 3046     		mov	r0, r6
 384              	.LVL51:
 385              	.L19:
 210:FreeModbus/app/user_mb_app_m.c ****             {
 386              		.loc 1 210 19 is_stmt 1 view .LVU128
 387 004e 012D     		cmp	r5, #1
 388 0050 F1D8     		bhi	.L20
 215:FreeModbus/app/user_mb_app_m.c ****             }
 216:FreeModbus/app/user_mb_app_m.c ****             /* last coils */
 217:FreeModbus/app/user_mb_app_m.c ****             usNCoils = usNCoils % 8;
 389              		.loc 1 217 13 view .LVU129
 390              	.LVL52:
 218:FreeModbus/app/user_mb_app_m.c ****             /* xMBUtilSetBits has bug when ucNBits is zero */
 219:FreeModbus/app/user_mb_app_m.c ****             if (usNCoils != 0)
 391              		.loc 1 219 13 view .LVU130
 392              		.loc 1 219 16 is_stmt 0 view .LVU131
 393 0052 19F00702 		ands	r2, r9, #7
 394 0056 01D1     		bne	.L24
 167:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 395              		.loc 1 167 21 view .LVU132
 396 0058 0020     		movs	r0, #0
 397              	.LVL53:
 167:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 398              		.loc 1 167 21 view .LVU133
 399 005a 07E0     		b	.L18
 400              	.LVL54:
 401              	.L24:
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 12


 220:FreeModbus/app/user_mb_app_m.c ****             {
 221:FreeModbus/app/user_mb_app_m.c ****                 xMBUtilSetBits(&pucCoilBuf[iRegIndex++], iRegBitIndex, usNCoils,
 402              		.loc 1 221 17 is_stmt 1 view .LVU134
 403              		.loc 1 221 17 is_stmt 0 view .LVU135
 404 005c 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 405 005e 3946     		mov	r1, r7
 406 0060 4044     		add	r0, r0, r8
 407              	.LVL55:
 408              		.loc 1 221 17 view .LVU136
 409 0062 FFF7FEFF 		bl	xMBUtilSetBits
 410              	.LVL56:
 167:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 411              		.loc 1 167 21 view .LVU137
 412 0066 0020     		movs	r0, #0
 413 0068 00E0     		b	.L18
 414              	.LVL57:
 415              	.L21:
 222:FreeModbus/app/user_mb_app_m.c ****                         *pucRegBuffer++);
 223:FreeModbus/app/user_mb_app_m.c ****             }
 224:FreeModbus/app/user_mb_app_m.c ****             break;
 225:FreeModbus/app/user_mb_app_m.c ****         }
 226:FreeModbus/app/user_mb_app_m.c ****     }
 227:FreeModbus/app/user_mb_app_m.c ****     else
 228:FreeModbus/app/user_mb_app_m.c ****     {
 229:FreeModbus/app/user_mb_app_m.c ****         eStatus = MB_ENOREG;
 416              		.loc 1 229 17 view .LVU138
 417 006a 0120     		movs	r0, #1
 418              	.LVL58:
 419              	.L18:
 230:FreeModbus/app/user_mb_app_m.c ****     }
 231:FreeModbus/app/user_mb_app_m.c ****     return eStatus;
 420              		.loc 1 231 5 is_stmt 1 view .LVU139
 232:FreeModbus/app/user_mb_app_m.c **** #else
 233:FreeModbus/app/user_mb_app_m.c **** 	return MB_ENOREG;
 234:FreeModbus/app/user_mb_app_m.c **** #endif
 235:FreeModbus/app/user_mb_app_m.c **** }
 421              		.loc 1 235 1 is_stmt 0 view .LVU140
 422 006c BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 423              	.LVL59:
 424              	.L26:
 425              		.loc 1 235 1 view .LVU141
 426              		.align	2
 427              	.L25:
 428 0070 00000000 		.word	.LANCHOR4
 429 0074 00000000 		.word	.LANCHOR5
 430              		.cfi_endproc
 431              	.LFE67:
 433              		.section	.text.eMBMasterRegDiscreteCB,"ax",%progbits
 434              		.align	1
 435              		.global	eMBMasterRegDiscreteCB
 436              		.syntax unified
 437              		.thumb
 438              		.thumb_func
 440              	eMBMasterRegDiscreteCB:
 441              	.LVL60:
 442              	.LFB68:
 236:FreeModbus/app/user_mb_app_m.c **** 
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 13


 237:FreeModbus/app/user_mb_app_m.c **** /**
 238:FreeModbus/app/user_mb_app_m.c ****  * Modbus master discrete callback function.
 239:FreeModbus/app/user_mb_app_m.c ****  *
 240:FreeModbus/app/user_mb_app_m.c ****  * @param pucRegBuffer discrete buffer
 241:FreeModbus/app/user_mb_app_m.c ****  * @param usAddress discrete address
 242:FreeModbus/app/user_mb_app_m.c ****  * @param usNDiscrete discrete number
 243:FreeModbus/app/user_mb_app_m.c ****  *
 244:FreeModbus/app/user_mb_app_m.c ****  * @return result
 245:FreeModbus/app/user_mb_app_m.c ****  */
 246:FreeModbus/app/user_mb_app_m.c **** eMBErrorCode eMBMasterRegDiscreteCB( UCHAR * pucRegBuffer, USHORT usAddress, USHORT usNDiscrete )
 247:FreeModbus/app/user_mb_app_m.c **** {
 443              		.loc 1 247 1 is_stmt 1 view -0
 444              		.cfi_startproc
 445              		@ args = 0, pretend = 0, frame = 0
 446              		@ frame_needed = 0, uses_anonymous_args = 0
 447              		.loc 1 247 1 is_stmt 0 view .LVU143
 448 0000 2DE9F843 		push	{r3, r4, r5, r6, r7, r8, r9, lr}
 449              	.LCFI3:
 450              		.cfi_def_cfa_offset 32
 451              		.cfi_offset 3, -32
 452              		.cfi_offset 4, -28
 453              		.cfi_offset 5, -24
 454              		.cfi_offset 6, -20
 455              		.cfi_offset 7, -16
 456              		.cfi_offset 8, -12
 457              		.cfi_offset 9, -8
 458              		.cfi_offset 14, -4
 459 0004 0446     		mov	r4, r0
 460 0006 0F46     		mov	r7, r1
 461 0008 9146     		mov	r9, r2
 248:FreeModbus/app/user_mb_app_m.c **** #if M_DISCRETE_INPUT_NDISCRETES > 0
 249:FreeModbus/app/user_mb_app_m.c ****     eMBErrorCode    eStatus = MB_ENOERR;
 462              		.loc 1 249 5 is_stmt 1 view .LVU144
 463              	.LVL61:
 250:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 464              		.loc 1 250 5 view .LVU145
 251:FreeModbus/app/user_mb_app_m.c ****     UCHAR *         pucDiscreteInputBuf;
 465              		.loc 1 251 5 view .LVU146
 252:FreeModbus/app/user_mb_app_m.c ****     USHORT          DISCRETE_INPUT_START;
 466              		.loc 1 252 5 view .LVU147
 253:FreeModbus/app/user_mb_app_m.c ****     USHORT          DISCRETE_INPUT_NDISCRETES;
 467              		.loc 1 253 5 view .LVU148
 254:FreeModbus/app/user_mb_app_m.c ****     USHORT          usDiscreteInputStart;
 468              		.loc 1 254 5 view .LVU149
 255:FreeModbus/app/user_mb_app_m.c ****     iNReg =  usNDiscrete / 8 + 1;
 469              		.loc 1 255 5 view .LVU150
 470              		.loc 1 255 30 is_stmt 0 view .LVU151
 471 000a D508     		lsrs	r5, r2, #3
 472              	.LVL62:
 256:FreeModbus/app/user_mb_app_m.c **** 
 257:FreeModbus/app/user_mb_app_m.c ****     pucDiscreteInputBuf = ucMDiscInBuf[ucMBMasterGetDestAddress() - 1];
 473              		.loc 1 257 5 is_stmt 1 view .LVU152
 474              		.loc 1 257 40 is_stmt 0 view .LVU153
 475 000c FFF7FEFF 		bl	ucMBMasterGetDestAddress
 476              	.LVL63:
 477              		.loc 1 257 67 view .LVU154
 478 0010 0138     		subs	r0, r0, #1
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 14


 479              		.loc 1 257 25 view .LVU155
 480 0012 174B     		ldr	r3, .L35
 481 0014 03EB4008 		add	r8, r3, r0, lsl #1
 482              	.LVL64:
 258:FreeModbus/app/user_mb_app_m.c ****     DISCRETE_INPUT_START = M_DISCRETE_INPUT_START;
 483              		.loc 1 258 5 is_stmt 1 view .LVU156
 259:FreeModbus/app/user_mb_app_m.c ****     DISCRETE_INPUT_NDISCRETES = M_DISCRETE_INPUT_NDISCRETES;
 484              		.loc 1 259 5 view .LVU157
 260:FreeModbus/app/user_mb_app_m.c ****     usDiscreteInputStart = usMDiscInStart;
 485              		.loc 1 260 5 view .LVU158
 486              		.loc 1 260 26 is_stmt 0 view .LVU159
 487 0018 164B     		ldr	r3, .L35+4
 488 001a 1A88     		ldrh	r2, [r3]
 489              	.LVL65:
 261:FreeModbus/app/user_mb_app_m.c **** 
 262:FreeModbus/app/user_mb_app_m.c ****     /* it already plus one in modbus function method. */
 263:FreeModbus/app/user_mb_app_m.c ****     usAddress--;
 490              		.loc 1 263 5 is_stmt 1 view .LVU160
 491              		.loc 1 263 14 is_stmt 0 view .LVU161
 492 001c 013F     		subs	r7, r7, #1
 493 001e BFB2     		uxth	r7, r7
 494              	.LVL66:
 264:FreeModbus/app/user_mb_app_m.c **** 
 265:FreeModbus/app/user_mb_app_m.c ****     if ((usAddress >= DISCRETE_INPUT_START) && (usAddress + usNDiscrete    <= DISCRETE_INPUT_START 
 495              		.loc 1 265 5 is_stmt 1 view .LVU162
 496              		.loc 1 265 59 is_stmt 0 view .LVU163
 497 0020 07EB0903 		add	r3, r7, r9
 498              		.loc 1 265 45 view .LVU164
 499 0024 102B     		cmp	r3, #16
 500 0026 20DC     		bgt	.L31
 501 0028 0135     		adds	r5, r5, #1
 502              	.LVL67:
 266:FreeModbus/app/user_mb_app_m.c ****     {
 267:FreeModbus/app/user_mb_app_m.c ****         iRegIndex = (USHORT) (usAddress - usDiscreteInputStart) / 8;
 503              		.loc 1 267 9 is_stmt 1 view .LVU165
 504              		.loc 1 267 21 is_stmt 0 view .LVU166
 505 002a BF1A     		subs	r7, r7, r2
 506              	.LVL68:
 507              		.loc 1 267 19 view .LVU167
 508 002c C7F3CC00 		ubfx	r0, r7, #3, #13
 509              	.LVL69:
 268:FreeModbus/app/user_mb_app_m.c ****         iRegBitIndex = (USHORT) (usAddress - usDiscreteInputStart) % 8;
 510              		.loc 1 268 9 is_stmt 1 view .LVU168
 511              		.loc 1 268 22 is_stmt 0 view .LVU169
 512 0030 07F00707 		and	r7, r7, #7
 513              	.LVL70:
 269:FreeModbus/app/user_mb_app_m.c **** 
 270:FreeModbus/app/user_mb_app_m.c ****         /* write current discrete values with new values from the protocol stack. */
 271:FreeModbus/app/user_mb_app_m.c ****         while (iNReg > 1)
 514              		.loc 1 271 9 is_stmt 1 view .LVU170
 515              		.loc 1 271 15 is_stmt 0 view .LVU171
 516 0034 0BE0     		b	.L29
 517              	.LVL71:
 518              	.L30:
 272:FreeModbus/app/user_mb_app_m.c ****         {
 273:FreeModbus/app/user_mb_app_m.c ****             xMBUtilSetBits(&pucDiscreteInputBuf[iRegIndex++], iRegBitIndex, 8,
 519              		.loc 1 273 13 is_stmt 1 view .LVU172
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 15


 520              		.loc 1 273 58 is_stmt 0 view .LVU173
 521 0036 461C     		adds	r6, r0, #1
 522 0038 B6B2     		uxth	r6, r6
 523              	.LVL72:
 524              		.loc 1 273 13 view .LVU174
 525 003a 14F8013B 		ldrb	r3, [r4], #1	@ zero_extendqisi2
 526              	.LVL73:
 527              		.loc 1 273 13 view .LVU175
 528 003e 0822     		movs	r2, #8
 529 0040 3946     		mov	r1, r7
 530 0042 4044     		add	r0, r0, r8
 531 0044 FFF7FEFF 		bl	xMBUtilSetBits
 532              	.LVL74:
 274:FreeModbus/app/user_mb_app_m.c ****                     *pucRegBuffer++);
 275:FreeModbus/app/user_mb_app_m.c ****             iNReg--;
 533              		.loc 1 275 13 is_stmt 1 view .LVU176
 534              		.loc 1 275 18 is_stmt 0 view .LVU177
 535 0048 013D     		subs	r5, r5, #1
 536              	.LVL75:
 537              		.loc 1 275 18 view .LVU178
 538 004a ADB2     		uxth	r5, r5
 539              	.LVL76:
 273:FreeModbus/app/user_mb_app_m.c ****                     *pucRegBuffer++);
 540              		.loc 1 273 58 view .LVU179
 541 004c 3046     		mov	r0, r6
 542              	.LVL77:
 543              	.L29:
 271:FreeModbus/app/user_mb_app_m.c ****         {
 544              		.loc 1 271 15 is_stmt 1 view .LVU180
 545 004e 012D     		cmp	r5, #1
 546 0050 F1D8     		bhi	.L30
 276:FreeModbus/app/user_mb_app_m.c ****         }
 277:FreeModbus/app/user_mb_app_m.c ****         /* last discrete */
 278:FreeModbus/app/user_mb_app_m.c ****         usNDiscrete = usNDiscrete % 8;
 547              		.loc 1 278 9 view .LVU181
 548              	.LVL78:
 279:FreeModbus/app/user_mb_app_m.c ****         /* xMBUtilSetBits has bug when ucNBits is zero */
 280:FreeModbus/app/user_mb_app_m.c ****         if (usNDiscrete != 0)
 549              		.loc 1 280 9 view .LVU182
 550              		.loc 1 280 12 is_stmt 0 view .LVU183
 551 0052 19F00702 		ands	r2, r9, #7
 552 0056 01D1     		bne	.L34
 249:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 553              		.loc 1 249 21 view .LVU184
 554 0058 0020     		movs	r0, #0
 555              	.LVL79:
 249:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 556              		.loc 1 249 21 view .LVU185
 557 005a 07E0     		b	.L28
 558              	.LVL80:
 559              	.L34:
 281:FreeModbus/app/user_mb_app_m.c ****         {
 282:FreeModbus/app/user_mb_app_m.c ****             xMBUtilSetBits(&pucDiscreteInputBuf[iRegIndex++], iRegBitIndex,
 560              		.loc 1 282 13 is_stmt 1 view .LVU186
 561              		.loc 1 282 13 is_stmt 0 view .LVU187
 562 005c 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 563 005e 3946     		mov	r1, r7
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 16


 564 0060 4044     		add	r0, r0, r8
 565              	.LVL81:
 566              		.loc 1 282 13 view .LVU188
 567 0062 FFF7FEFF 		bl	xMBUtilSetBits
 568              	.LVL82:
 249:FreeModbus/app/user_mb_app_m.c ****     USHORT          iRegIndex , iRegBitIndex , iNReg;
 569              		.loc 1 249 21 view .LVU189
 570 0066 0020     		movs	r0, #0
 571 0068 00E0     		b	.L28
 572              	.LVL83:
 573              	.L31:
 283:FreeModbus/app/user_mb_app_m.c ****                     usNDiscrete, *pucRegBuffer++);
 284:FreeModbus/app/user_mb_app_m.c ****         }
 285:FreeModbus/app/user_mb_app_m.c ****     }
 286:FreeModbus/app/user_mb_app_m.c ****     else
 287:FreeModbus/app/user_mb_app_m.c ****     {
 288:FreeModbus/app/user_mb_app_m.c ****         eStatus = MB_ENOREG;
 574              		.loc 1 288 17 view .LVU190
 575 006a 0120     		movs	r0, #1
 576              	.LVL84:
 577              	.L28:
 289:FreeModbus/app/user_mb_app_m.c ****     }
 290:FreeModbus/app/user_mb_app_m.c **** 
 291:FreeModbus/app/user_mb_app_m.c ****     return eStatus;
 578              		.loc 1 291 5 is_stmt 1 view .LVU191
 292:FreeModbus/app/user_mb_app_m.c **** #else
 293:FreeModbus/app/user_mb_app_m.c **** 	return MB_ENOREG;
 294:FreeModbus/app/user_mb_app_m.c **** #endif
 295:FreeModbus/app/user_mb_app_m.c **** }
 579              		.loc 1 295 1 is_stmt 0 view .LVU192
 580 006c BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 581              	.LVL85:
 582              	.L36:
 583              		.loc 1 295 1 view .LVU193
 584              		.align	2
 585              	.L35:
 586 0070 00000000 		.word	.LANCHOR6
 587 0074 00000000 		.word	.LANCHOR7
 588              		.cfi_endproc
 589              	.LFE68:
 591              		.global	usMRegHoldBuf
 592              		.global	usMRegHoldStart
 593              		.global	usMRegInBuf
 594              		.global	usMRegInStart
 595              		.global	ucMCoilBuf
 596              		.global	usMCoilStart
 597              		.global	ucMDiscInBuf
 598              		.global	usMDiscInStart
 599              		.section	.bss.ucMCoilBuf,"aw",%nobits
 600              		.align	2
 601              		.set	.LANCHOR4,. + 0
 604              	ucMCoilBuf:
 605 0000 00000000 		.space	32
 605      00000000 
 605      00000000 
 605      00000000 
 605      00000000 
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 17


 606              		.section	.bss.ucMDiscInBuf,"aw",%nobits
 607              		.align	2
 608              		.set	.LANCHOR6,. + 0
 611              	ucMDiscInBuf:
 612 0000 00000000 		.space	32
 612      00000000 
 612      00000000 
 612      00000000 
 612      00000000 
 613              		.section	.bss.usMCoilStart,"aw",%nobits
 614              		.align	1
 615              		.set	.LANCHOR5,. + 0
 618              	usMCoilStart:
 619 0000 0000     		.space	2
 620              		.section	.bss.usMDiscInStart,"aw",%nobits
 621              		.align	1
 622              		.set	.LANCHOR7,. + 0
 625              	usMDiscInStart:
 626 0000 0000     		.space	2
 627              		.section	.bss.usMRegHoldBuf,"aw",%nobits
 628              		.align	2
 629              		.set	.LANCHOR2,. + 0
 632              	usMRegHoldBuf:
 633 0000 00000000 		.space	3200
 633      00000000 
 633      00000000 
 633      00000000 
 633      00000000 
 634              		.section	.bss.usMRegHoldStart,"aw",%nobits
 635              		.align	1
 636              		.set	.LANCHOR3,. + 0
 639              	usMRegHoldStart:
 640 0000 0000     		.space	2
 641              		.section	.bss.usMRegInBuf,"aw",%nobits
 642              		.align	2
 643              		.set	.LANCHOR0,. + 0
 646              	usMRegInBuf:
 647 0000 00000000 		.space	512
 647      00000000 
 647      00000000 
 647      00000000 
 647      00000000 
 648              		.section	.bss.usMRegInStart,"aw",%nobits
 649              		.align	1
 650              		.set	.LANCHOR1,. + 0
 653              	usMRegInStart:
 654 0000 0000     		.space	2
 655              		.text
 656              	.Letext0:
 657              		.file 2 "e:\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\machine\\_default_typ
 658              		.file 3 "e:\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\sys\\_stdint.h"
 659              		.file 4 "FreeModbus/port/port.h"
 660              		.file 5 "FreeModbus/include/mb.h"
 661              		.file 6 "FreeModbus/app/user_mb_app_m.h"
 662              		.file 7 "FreeModbus/include/mb_m.h"
 663              		.file 8 "FreeModbus/include/mbutils.h"
ARM GAS  C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s 			page 18


DEFINED SYMBOLS
                            *ABS*:00000000 user_mb_app_m.c
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:18     .text.eMBMasterRegInputCB:00000000 $t
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:24     .text.eMBMasterRegInputCB:00000000 eMBMasterRegInputCB
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:141    .text.eMBMasterRegInputCB:00000054 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:147    .text.eMBMasterRegHoldingCB:00000000 $t
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:153    .text.eMBMasterRegHoldingCB:00000000 eMBMasterRegHoldingCB
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:270    .text.eMBMasterRegHoldingCB:00000058 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:276    .text.eMBMasterRegCoilsCB:00000000 $t
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:282    .text.eMBMasterRegCoilsCB:00000000 eMBMasterRegCoilsCB
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:428    .text.eMBMasterRegCoilsCB:00000070 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:434    .text.eMBMasterRegDiscreteCB:00000000 $t
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:440    .text.eMBMasterRegDiscreteCB:00000000 eMBMasterRegDiscreteCB
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:586    .text.eMBMasterRegDiscreteCB:00000070 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:632    .bss.usMRegHoldBuf:00000000 usMRegHoldBuf
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:639    .bss.usMRegHoldStart:00000000 usMRegHoldStart
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:646    .bss.usMRegInBuf:00000000 usMRegInBuf
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:653    .bss.usMRegInStart:00000000 usMRegInStart
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:604    .bss.ucMCoilBuf:00000000 ucMCoilBuf
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:618    .bss.usMCoilStart:00000000 usMCoilStart
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:611    .bss.ucMDiscInBuf:00000000 ucMDiscInBuf
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:625    .bss.usMDiscInStart:00000000 usMDiscInStart
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:600    .bss.ucMCoilBuf:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:607    .bss.ucMDiscInBuf:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:614    .bss.usMCoilStart:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:621    .bss.usMDiscInStart:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:628    .bss.usMRegHoldBuf:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:635    .bss.usMRegHoldStart:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:642    .bss.usMRegInBuf:00000000 $d
C:\Users\BLACK_~1\AppData\Local\Temp\ccOcGI6J.s:649    .bss.usMRegInStart:00000000 $d

UNDEFINED SYMBOLS
ucMBMasterGetDestAddress
xMBUtilSetBits
